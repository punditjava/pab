var $jscomp={scope:{},findInternal:function(b,l,e){b instanceof String&&(b=String(b));for(var m=b.length,g=0;g<m;g++){var u=b[g];if(l.call(e,u,g,b))return{i:g,v:u}}return{i:-1,v:void 0}}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(b,l,e){if(e.get||e.set)throw new TypeError("ES3 does not support getters and setters.");b!=Array.prototype&&b!=Object.prototype&&(b[l]=e.value)};
$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(b,l,e,m){if(l){e=$jscomp.global;b=b.split(".");for(m=0;m<b.length-1;m++){var g=b[m];g in e||(e[g]={});e=e[g]}b=b[b.length-1];m=e[b];l=l(m);l!=m&&null!=l&&$jscomp.defineProperty(e,b,{configurable:!0,writable:!0,value:l})}};
$jscomp.polyfill("Array.prototype.find",function(b){return b?b:function(b,e){return $jscomp.findInternal(this,b,e).v}},"es6-impl","es3");
(function(b,l,e,m){function g(b){var h=Math.floor(b/60),e=Math.floor(h/60);b=Math.floor(b%60);return(0<e?e+":":"")+("0"+h%60).slice(-2)+":"+("0"+b).slice(-2)}function u(b){var e=b.outerWidth();b.removeClass("audioplayer-layout-480");b.removeClass("audioplayer-layout-600");b.removeClass("audioplayer-layout-900");440<=e&&b.addClass("audioplayer-layout-480");600<=e&&b.addClass("audioplayer-layout-600");900<=e&&b.addClass("audioplayer-layout-900")}function N(e,g){var h=g.hasClass("audioplayer-playing");
e?(b(".audioplayer__fullscreen").length||b("body").append('<div class="audioplayer__fullscreen m-hidden"></div>'),g.wrap('<div class="audioplayer__holder"></div>'),b(".audioplayer__fullscreen").removeClass("m-hidden").append(g),ria.disablePageScroll(!0)):(b(".audioplayer__holder").append(g),b(".audioplayer__fullscreen").addClass("m-hidden"),g.unwrap('<div class="audioplayer__holder"></div>'),ria.disablePageScroll(!1));u(g);h&&g.find("audio").get(0).play()}var w="ontouchstart"in l,O=w?"touchstart":
"mousedown",y=w?"touchmove":"mousemove",P=w?"touchcancel":"mouseup";b.fn.audioPlayer=function(h){function m(c){if(c.items.length){var n="",d=c.items.length;a.find(".audioplayer__rubric span").html(100>c.items.length?" <span>"+d+"</span>/"+d:" 99+");b.each(c.items,function(b,c){var e=c.id==a.data("import-id")?" active":"";""!=e&&(a.find(".audioplayer__rubric span > span").text(d),a.find(".share").attr({"data-url":c.url,"data-id":c.articleid}));var f="";ria.lsGet("audio_progress_"+c.id)&&(f=" / <span>"+
g(ria.lsGet("audio_progress_"+c.id))+"</span>");n+='<div class="audioplayer__playlist-item'+e+'" data-src="'+c.mp3+'" data-text="'+c.text.replace(/"/g,"&quot;")+'" data-cover="'+c.img+'" data-id="'+c.id+'" data-url="'+c.url+'" data-articleid="'+c.articleid+'"><div class="audioplayer__playlist-item-icon">'+ria.getIcon("icon-play_small")+'</div><div class="audioplayer__playlist-item-pos">'+d+'</div><div class="audioplayer__playlist-item-main"><div class="audioplayer__playlist-item-title">'+c.title+
'</div><div class="audioplayer__playlist-item-duration">'+g(c.duration)+f+'</div></div><div class="audioplayer__playlist-item-date">'+c.date+"</div></div>";d--});a.find(".audioplayer__playlist-list-content").html(n);a.find(".audioplayer__playlist-list").theinScroll()}1<c.items.length?(B.removeClass("hidden"),C.removeClass("hidden")):(B.addClass("hidden"),C.addClass("hidden"));"undefined"!==typeof c.subscription_id&&""!=c.subscription_id&&(a.attr("data-subscribe-ria2",c.subscription_id),D.parent().removeClass("hidden"))}
function M(b){a.addClass(f.modal).attr("data-state","modal-"+b);a.find(".audioplayer__"+b).addClass("active");480>e.documentElement.clientWidth&&N(!0,a)}function Q(b){a.removeClass(f.modal).attr("data-state","");b.removeClass("active");a.parent().hasClass("audioplayer__fullscreen")&&N(!1,a)}if(this.length&&(1!=this.length||!b(this).hasClass("audioplayer-inited"))){h=b.extend({classPrefix:"audioplayer",strings:{play:"\u0412\u043e\u0441\u043f\u0440\u043e\u0438\u0437\u0432\u0435\u0441\u0442\u0438",pause:"\u041f\u0440\u0438\u043e\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c",
volume:"\u0413\u0440\u043e\u043c\u043a\u043e\u0441\u0442\u044c",speed:"\u0421\u043a\u043e\u0440\u043e\u0441\u0442\u044c \u0432\u043e\u0441\u043f\u0440\u043e\u0438\u0437\u0432\u0435\u0434\u0435\u043d\u0438\u044f",download:"\u0421\u043a\u0430\u0447\u0430\u0442\u044c",subscribe:"\u041f\u043e\u0434\u043f\u0438\u0441\u0430\u0442\u044c\u0441\u044f",more:"\u0421\u043c\u043e\u0442\u0440\u0435\u0442\u044c \u0432\u0441\u0435 \u044d\u043f\u0438\u0437\u043e\u0434\u044b",about:"\u041e \u0432\u044b\u043f\u0443\u0441\u043a\u0435"}},
h);var f={},p={playing:"playing",stopped:"stopped",noVolume:"novolume",muted:"muted",modal:"modal",live:"live"},q;for(q in p)f[q]=h.classPrefix+"-"+p[q];if(1<this.length)return this.each(function(){b(this).audioPlayer(h)}),this;var a=b(this),c=a.find("audio").get(0);u(a);b(l).resize(function(){u(a)});p="";""!=a.data("rubric")&&(p='<div class="audioplayer__subscribe audioplayer__top-button"><div class="audioplayer__subscribe-button"><span>'+ria.getIcon("icon-e-mail_small")+"</span><span>"+h.strings.subscribe+
'</span></div><div class="audioplayer__subscribe-list"><ul>'+(""!=a.data("subscribe-itunes")?'<li><a href="'+a.data("subscribe-itunes")+'" target="_blank">iTunes</a></li>':"")+(""!=a.data("subscribe-googlepodcasts")?'<li><a href="'+a.data("subscribe-googlepodcasts")+'" target="_blank">Google</a></li>':"")+(""!=a.data("subscribe-tunein")?'<li><a href="'+a.data("subscribe-tunein")+'" target="_blank">TuneIn</a></li>':"")+(""!=a.data("subscribe-castbox")?'<li><a href="'+a.data("subscribe-castbox")+'" target="_blank">Castbox</a></li>':
"")+(""!=a.data("subscribe-soundstream")?'<li><a href="'+a.data("subscribe-soundstream")+'" target="_blank">Soundstream</a></li>':"")+(""!=a.data("subscribe-yandexmusic")?'<li><a href="'+a.data("subscribe-yandexmusic")+'" target="_blank">\u042f\u043d\u0434\u0435\u043a\u0441.\u041c\u0443\u0437\u044b\u043a\u0430</a></li>':"")+(""!=a.data("subscribe-rss")?'<li><a href="'+a.data("subscribe-rss")+'" target="_blank">RSS</a></li>':"")+'<li class="hidden"><a href="/" class="audioplayer__ria-subscribe">Ria.ru</a></li></ul></div></div>');
var z=q="",A="",x="";a.hasClass("audioplayer-vast")||(q='<div class="audioplayer__controls-right"><div class="audioplayer__controls-download" title="'+h.strings.download+'"><a href="'+c.src+'" download="podcast" target="_blank">'+ria.getIcon("icon-download")+'</a></div><div class="audioplayer__controls-share"><span class="share" data-nosnippet="true" data-id="'+a.data("articleid")+'" data-url="'+location.href+'" data-title="'+a.data("media-title").replace(/\\"/g,"&quot;")+'"></span></div></div>',
z='<div class="audioplayer__controls-download audioplayer__top-button" title="'+h.strings.download+'"><a href="'+c.src+'" download="podcast" target="_blank"><span>'+ria.getIcon("icon-download")+"</span><span>"+h.strings.download+"</span></a></div>",A='<div class="audioplayer__modal audioplayer__playlist"><div class="audioplayer__modal-close">'+ria.getIcon("icon-close")+'</div><div class="audioplayer__playlist-info"><div class="audioplayer__playlist-title">'+a.data("rubric-title").replace(/\\"/g,'"')+
'</div><div class="audioplayer__playlist-text">'+a.data("rubric-subtitle").replace(/\\"/g,'"')+'</div><a href="'+a.data("rubric-url")+'" class="audioplayer__playlist-more">'+h.strings.more+'</a></div><div class="audioplayer__playlist-list"><div class="audioplayer__playlist-list-content"></div></div></div>',x='<div class="audioplayer__modal audioplayer__about"><div class="audioplayer__modal-close">'+ria.getIcon("icon-close")+'</div><div class="audioplayer__about-title">'+a.data("media-title").replace(/\\"/g,
'"')+'</div><div class="audioplayer__about-text"><div class="audioplayer__about-text-content">'+a.data("media-descr").replace(/\\"/g,'"')+"</div></div></div>");p='<div class="audioplayer__controls hidden"><div class="audioplayer__current-time"></div><div class="audioplayer__total-time"></div><div class="audioplayer__controls-seekbar"><div class="audioplayer__controls-seekbar-line"><div class="audioplayer__controls-seekbar-all"></div><div class="audioplayer__controls-seekbar-loaded"></div><div class="audioplayer__controls-seekbar-played"></div></div></div><div class="audioplayer__controls-left"><div class="audioplayer__controls-volume"><div class="audioplayer__controls-volume-button" title="'+
h.strings.volume+'">'+ria.getIcon("icon-sound")+ria.getIcon("icon-mute")+'</div><div class="audioplayer__controls-volume-adjust"><div><div></div></div></div></div><div class="audioplayer__controls-speed"><div class="audioplayer__controls-speed-button" title="'+h.strings.speed+'">'+ria.getIcon("icon-close_small")+'<span>1</span></div><div class="audioplayer__controls-speed-list"><ul><li data-value="0.8">0,8</li><li data-value="1" class="active">1</li><li data-value="1.5">1,5</li><li data-value="2">2</li></ul></div></div></div><div class="audioplayer__controls-center"><div class="audioplayer__controls-rw">'+
ria.getIcon("icon-backward")+'</div><div class="audioplayer__controls-play" title="'+h.strings.play+'">'+ria.getIcon("icon-play_small")+ria.getIcon("icon-pause_small")+'</div><div class="audioplayer__controls-fw">'+ria.getIcon("icon-forward")+"</div></div>"+q+"</div>"+p+'<div class="audioplayer__prev hidden">'+ria.getIcon("icon-left_single")+'</div><div class="audioplayer__next hidden">'+ria.getIcon("icon-right_single")+'</div><div class="audioplayer__about-button audioplayer__top-button"><span>i</span><span>'+
h.strings.about+"</span></div>"+z+A+x;a.append(p);var k=a.find(".audioplayer__controls"),p=k.find(".audioplayer__controls-play");q=k.find(".audioplayer__controls-rw");var z=k.find(".audioplayer__controls-fw"),E=k.find(".audioplayer__current-time"),R=k.find(".audioplayer__total-time"),t=k.find(".audioplayer__controls-seekbar"),W=t.find(".audioplayer__controls-seekbar-played"),X=t.find(".audioplayer__controls-seekbar-loaded"),A=k.find(".audioplayer__controls-volume-button"),v=k.find(".audioplayer__controls-volume-adjust > div"),
F=0,G=!1,H=!1,I=!1,J=!1,K=!1,L=!1,S=k.find(".audioplayer__controls-speed-button"),x=k.find(".audioplayer__controls-speed li"),B=a.find(".audioplayer__prev"),C=a.find(".audioplayer__next"),D=a.find(".audioplayer__ria-subscribe"),T=function(a){realEvent=w?a.originalEvent.touches[0]:a;c.currentTime=Math.round(c.duration*(realEvent.pageX-t.offset().left)/t.width())},U=function(a){realEvent=w?a.originalEvent.touches[0]:a;a=Math.abs((realEvent.pageY-(v.offset().top+85))/85);c.volume=1<a?1:a;ria.lsSet("audio_volume",
c.volume)},Y=function(){var a=setInterval(function(){if(1>c.buffered.length)return!0;X.width(c.buffered.end(0)/c.duration*100+"%");Math.floor(c.buffered.end(0))>=Math.floor(c.duration)&&clearInterval(a)},500)},d={};d.url=a.data("vast");var r="",V=function(c){b.ajax({url:"/services/mailing/subscribe/?newsletter_id="+a.data("subscribe-ria2")+"&email="+c,dataType:"json",beforeSend:function(a){}}).done(function(a){"OK"==a.status&&b(".js-subscribe").addClass("m-done")})};if(D.length)D.on("click",function(){GLOBAL.user.mail?
V(GLOBAL.user.mail):modalLayer.open({preset:"authorization",beforeOpen:function(){if(!b(".modal__main-desc").length){var a=b("<div />").addClass("modal__main-desc").text("\u0414\u043b\u044f \u043f\u043e\u0434\u043f\u0438\u0441\u043a\u0438 \u043d\u0430 \u0440\u0430\u0441\u0441\u044b\u043b\u043a\u0443 \u0432\u0430\u043c \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u043e\u0432\u0430\u0442\u044c\u0441\u044f \u0438\u043b\u0438 \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c\u0441\u044f");
b(".modal__content.modal__auth").prepend(a)}GLOBAL.events.subscribe("login",function(a){"success"==a.status&&V(a.user.email)});if(b(".modal__main-desc").length)b(l).on("changeModalLayer",function(){b(".modal__main-desc").remove()})},afterClose:function(){b(".modal__main-desc").remove()}});return!1});k.removeClass("hidden");var k=c.volume,Z=c.volume=0;Math.round(1E3*c.volume)/1E3==Z?c.volume=k:a.addClass(f.noVolume);k=b('form[data-ajax="/services/mailing/subscribe/"]').attr("data-newsletter");""!=
a.data("rubric")&&("radiosputnik_live"==a.data("rubric")?m(playlist):b.ajax({url:"/services/audio/"+a.data("rubric")+"/"+(k?"?cta_newsletter_id="+k:""),dataType:"json"}).done(function(a){m(a)}).fail(function(a,b){}));"undefined"!==typeof d&&"undefined"!==typeof d.url&&(r="banner_",b.ajax({url:d.url}).done(function(n){var e=b(n).find("MediaFile").text().trim();c.src=e;c.addEventListener("loadedmetadata",function(){a.removeClass("audioplayer-splash")});n=b(n).find("TrackingEvents");d.tracking1=n.find('Tracking[event="start"]').text().trim();
d.tracking2=n.find('Tracking[event="firstQuartile"]').text().trim();d.tracking3=n.find('Tracking[event="midpoint"]').text().trim();d.tracking4=n.find('Tracking[event="thirdQuartile"]').text().trim();d.tracking5=n.find('Tracking[event="complete"]').text().trim();d.tracking6=n.find('Tracking[event="pause"]').text().trim()}).fail(function(a,b){}));c.volume=ria.lsGet("audio_volume")?ria.lsGet("audio_volume"):1;v.find("div").height(100*c.volume+"%");F=c.volume;E.text(g(0));R.text(b.isNumeric(c.duration)?
g(c.duration):"");c.playbackRate=ria.lsGet("audio_playbackrate")?ria.lsGet("audio_playbackrate"):1;S.find("span").text(c.playbackRate);x.removeClass("active").filter('[data-value="'+c.playbackRate+'"]').addClass("active");c.addEventListener("loadedmetadata",function(){Y();E.text(g(0));R.text(b.isNumeric(c.duration)?g(c.duration):"...");"Infinity"==c.duration?a.addClass(f.live):a.removeClass(f.live)});c.addEventListener("playing",function(){b(".audioplayer").find("audio").each(function(){b(this).get(0)!=
c&&b(this).get(0).pause()});a.addClass(f.playing).removeClass(f.stopped);a.removeClass("audioplayer-splash");b("body").trigger("audioplayer",["playing",a.attr("data-import-id")]);"Infinity"==c.duration?(a.addClass(f.live),c.playbackRate=1):(a.removeClass(f.live),c.playbackRate=ria.lsGet("audio_playbackrate")?ria.lsGet("audio_playbackrate"):1)});c.addEventListener("pause",function(){a.removeClass(f.playing).addClass(f.stopped);b("body").trigger("audioplayer",["pause",a.attr("data-import-id")]);"undefined"!==
typeof d&&"undefined"!==typeof d.tracking6&&fetch(d.tracking6)});c.addEventListener("ended",function(){a.removeClass(f.playing).addClass(f.stopped);b("body").trigger("audioplayer",["ended",a.attr("data-import-id")]);dataLayer.push({event:r+"Finished",gaEventCategory:"HTML5_Audio_Podcasts",gaEventAction:"Finished",gaEventLabel:a.attr("data-media-title"),player_rubric:a.attr("data-podcast")});"undefined"!==typeof d&&"undefined"!==typeof d.tracking5&&fetch(d.tracking5)});c.addEventListener("timeupdate",
function(){var b=c.currentTime/c.duration*100;E.text(g(this.currentTime));W.width(b+"%");ria.lsSet("audio_progress_"+a.attr("data-import-id"),c.currentTime);!G&&0<c.currentTime&&3>c.currentTime&&(dataLayer.push({event:r+"Play",gaEventCategory:"HTML5_Audio_Podcasts",gaEventAction:"Play",gaEventLabel:a.attr("data-media-title"),player_rubric:a.attr("data-podcast")}),"undefined"!==typeof d&&"undefined"!==typeof d.tracking1&&fetch(d.tracking1),G=!0);1<=b&&!H&&(dataLayer.push({event:r+"1%",gaEventCategory:"HTML5_Audio_Podcasts",
gaEventAction:"1%",gaEventLabel:a.attr("data-media-title"),player_rubric:a.attr("data-podcast")}),H=!0);25<=b&&!I&&(dataLayer.push({event:r+"25%",gaEventCategory:"HTML5_Audio_Podcasts",gaEventAction:"25%",gaEventLabel:a.attr("data-media-title"),player_rubric:a.attr("data-podcast")}),"undefined"!==typeof d&&"undefined"!==typeof d.tracking2&&fetch(d.tracking2),I=!0);50<=b&&!J&&(dataLayer.push({event:r+"50%",gaEventCategory:"HTML5_Audio_Podcasts",gaEventAction:"50%",gaEventLabel:a.attr("data-media-title"),
player_rubric:a.attr("data-podcast")}),"undefined"!==typeof d&&"undefined"!==typeof d.tracking3&&fetch(d.tracking3),J=!0);75<=b&&!K&&(dataLayer.push({event:r+"75%",gaEventCategory:"HTML5_Audio_Podcasts",gaEventAction:"75%",gaEventLabel:a.attr("data-media-title"),player_rubric:a.attr("data-podcast")}),"undefined"!==typeof d&&"undefined"!==typeof d.tracking4&&fetch(d.tracking4),K=!0);90<=b&&!L&&(dataLayer.push({event:r+"90%",gaEventCategory:"HTML5_Audio_Podcasts",gaEventAction:"90%",gaEventLabel:a.attr("data-media-title"),
player_rubric:a.attr("data-podcast")}),L=!0)});c.addEventListener("volumechange",function(){v.find("div").height(100*c.volume+"%");0<c.volume&&a.hasClass(f.muted)&&(a.removeClass(f.muted),c.muted=!1);0>=c.volume&&!a.hasClass(f.muted)&&(a.addClass(f.muted),c.muted=!0)});t.on(O,function(a){T(a);t.on(y,function(a){T(a)})}).on(P,function(){t.unbind(y)});A.on("click",function(){a.hasClass(f.muted)?(a.removeClass(f.muted),c.muted=!1,c.volume=F):(a.addClass(f.muted),c.muted=!0,F=c.volume,c.volume=0)});v.on(O,
function(a){U(a);v.on(y,function(a){U(a)})}).on(P,function(){v.unbind(y)});p.on("click",function(){a.hasClass(f.playing)?(b(this).attr("title",h.strings.play),c.pause()):(b(this).attr("title",h.strings.pause),c.play())});q.on("click",function(){c.currentTime-=30});z.on("click",function(){c.currentTime+=30});x.on("click",function(){c.playbackRate=b(this).data("value");S.find("span").text(b(this).text());ria.lsSet("audio_playbackrate",c.playbackRate);b(this).addClass("active").siblings().removeClass("active")});
a.find(".audioplayer__about-text").theinScroll();a.find(".audioplayer__rubric a").on("click",function(b){a.find(".audioplayer__playlist-item").length&&(b.preventDefault(),M("playlist"))});a.find(".audioplayer__about-button").on("click",function(){M("about")});a.find(".audioplayer__modal-close").on("click",function(){Q(b(this).parent())});a.find(".audioplayer__playlist-list").on("click",".audioplayer__playlist-item",function(){var d=b(this).data("id"),e=b(this).data("src"),g=b(this).data("cover"),
f=b(this).find(".audioplayer__playlist-item-title").text(),h=b(this).data("url"),k=b(this).data("articleid"),l=b(this).data("text"),m=b(this).find(".audioplayer__playlist-item-pos").text(),p=c.playbackRate;b(this).addClass("active").siblings().removeClass("active");Q(b(this).closest(".audioplayer__modal"));""!=g?a.removeClass("audioplayer-nocover").find(".audioplayer__cover").css("background-image","url("+g+")"):a.addClass("audioplayer-nocover").find(".audioplayer__cover").css("background-image",
"none");a.attr("data-import-id",d);a.attr("data-media-title",f);a.find(".audioplayer__about-title").html(f);a.find(".audioplayer__rubric span > span").text(m);a.find(".audioplayer__title-text").html(f);a.find(".audioplayer__about-text-content").html(l);a.find(".audioplayer__controls-download a").attr("href",e);a.find(".share").attr({"data-url":h,"data-title":f,"data-id":k});c.src=e;L=K=J=I=H=G=!1;c.load();c.playbackRate=p;c.play()});B.on("click",function(){a.find(".audioplayer__playlist-item.active").next().length?
a.find(".audioplayer__playlist-item.active").next().click():a.find(".audioplayer__playlist-item:first").click()});C.on("click",function(){a.find(".audioplayer__playlist-item.active").prev().length?a.find(".audioplayer__playlist-item.active").prev().click():a.find(".audioplayer__playlist-item:last").click()});this.play=function(){c.play()};this.pause=function(){c.pause()};this.playitem=function(b){a.find(".audioplayer__playlist-item[data-id="+b+"]").click()};a.find(".audioplayer__title").on("click",
function(){a.hasClass("audioplayer-splash")&&c.play()});a.addClass("audioplayer-inited");return this}}})(jQuery,window,document);$(function(){$(".audioplayer").audioPlayer()});
