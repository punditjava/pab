var $jscomp={scope:{},findInternal:function(d,h,f){d instanceof String&&(d=String(d));for(var k=d.length,g=0;g<k;g++){var l=d[g];if(h.call(f,l,g,d))return{i:g,v:l}}return{i:-1,v:void 0}}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(d,h,f){if(f.get||f.set)throw new TypeError("ES3 does not support getters and setters.");d!=Array.prototype&&d!=Object.prototype&&(d[h]=f.value)};
$jscomp.getGlobal=function(d){return"undefined"!=typeof window&&window===d?d:"undefined"!=typeof global&&null!=global?global:d};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(d,h,f,k){if(h){f=$jscomp.global;d=d.split(".");for(k=0;k<d.length-1;k++){var g=d[k];g in f||(f[g]={});f=f[g]}d=d[d.length-1];k=f[d];h=h(k);h!=k&&null!=h&&$jscomp.defineProperty(f,d,{configurable:!0,writable:!0,value:h})}};
$jscomp.polyfill("Array.prototype.find",function(d){return d?d:function(d,f){return $jscomp.findInternal(this,d,f).v}},"es6-impl","es3");var ria_chat={};
(function(){function d(a){return moment(a).calendar(null,{sameDay:"LT",lastDay:"[\u0412\u0447\u0435\u0440\u0430], LT",lastWeek:"DD MMMM, hh:mm",sameElse:function(a){return this.isBefore(a.startOf("year"))?"DD MMMM YYYY, hh:mm":"DD MMMM, hh:mm"}})}function h(){ria_chat.state.last_date?$.ajax({url:ria_chat.state.getUrl,dataType:"json",beforeSend:function(){ria_chat.state.loading=!0;ria_chat.state.chat.addClass("chat-loader")},data:{article_id:ria_chat.state.article_id,date:ria_chat.state.last_date.sec,
date_usec:ria_chat.state.last_date.usec,id_exc:ria_chat.state.last_id,limit:9999}}).done(function(a){if(a.chat.messages){var b=a.emoji_chat;ria_chat.state.last_date=a.chat.last_date;ria_chat.state.last_id=a.chat.last_id;ria_chat.state.last_date||(window.dataLayer=window.dataLayer||[],dataLayer.push({event:"chat",gaEventAction:"chat_scroll",gaEventLabel:"comments_100%"}));n({banned_profiles:a.banned_profiles,data:a.chat.messages,prepend:!0});if(b&&b.length)for(var c in b)a=b[c],q({emotions:a.emotions,
sorted_emotions:a.sorted_emotions,message_id:a.object_id});p("0")}}).always(function(){ria_chat.state.loading=!1;ria_chat.state.chat.removeClass("chat-loader")}):p("0")}function f(){ria_chat.state.last_date&&$.ajax({url:ria_chat.state.getUrl,dataType:"json",beforeSend:function(){ria_chat.state.loading=!0},data:{article_id:ria_chat.state.article_id,date:ria_chat.state.last_date.sec,date_usec:ria_chat.state.last_date.usec,id_exc:ria_chat.state.last_id}}).done(function(a){if(a.chat.messages){var b=a.emoji_chat;
ria_chat.state.last_date=a.chat.last_date;ria_chat.state.last_id=a.chat.last_id;ria_chat.state.last_date||(window.dataLayer=window.dataLayer||[],dataLayer.push({event:"chat",gaEventAction:"chat_scroll",gaEventLabel:"comments_100%"}));var c=ria_chat.state.chat_lenta.data("theinScroll"),c=c.$content.height()-c.$box.height();n({banned_profiles:a.banned_profiles,data:a.chat.messages,prepend:!0});if(b&&b.length)for(var d in b){var e=b[d];q({emotions:e.emotions,sorted_emotions:e.sorted_emotions,message_id:e.object_id})}a.chat.messages.length&&
ria_chat.state.chat_lenta.trigger("scroll-down.the-in-scroll",[c,100])}}).always(function(){ria_chat.state.loading=!1})}function k(a){_.assign(ria_chat.state,{unread:ria_chat.state.unread+a.count});if(0!==ria_chat.state.unread){var b=$(".chat__alert-unread");if(!b.length){var c=ria_chat.state.alertUnreadTemplate();a.before?a.before.before(c):ria_chat.state.chat_lenta.trigger("add-content.the-in-scroll",[c]);setTimeout(function(){b=$(".chat__alert-unread");ria_chat.state.chat_lenta.trigger("add-scrolling-trigger.the-in-scroll",
[{name:"unread_trigger",position:b.position().top+1,sign:">",once:!0}]);ria_chat.state.chat_lenta.on("unread_trigger.the-in-scroll",function(a,b){g()})},200)}$("#chatScrollDownBtn").attr("count",ria_chat.state.unread)}}function g(){ria_chat.state.markAsReadTimeout&&clearTimeout(ria_chat.state.markAsReadTimeout);ria_chat.state.markAsReadTimeout=setTimeout(function(){$.ajax({url:ria_chat.state.setLastUrl,data:{room_id:ria_chat.state.article_id,message_id:ria_chat.state.last_unread.id,date:ria_chat.state.last_unread.created.sec,
usec:ria_chat.state.last_unread.created.usec}}).done(function(){ria_chat_manager.updateUnread();_.assign(ria_chat.state,{unread:0});$("#chatScrollDownBtn").removeAttr("count")})},5E3)}function l(){p("100%")}function t(){var a=$(".chat__alert-unread");a.length?p(a.position().top-ria_chat.state.chat_lenta.data("theinScroll").$box.height()+50):l();ria_chat.state.unreadWhenChatOpen=!1}function p(a){ria_chat.state.chat_lenta.trigger("scroll-to.the-in-scroll",[a,100])}function u(a){a.preventDefault();ria_chat.state.unreadWhenChatOpen?
t():l()}function v(a){a.preventDefault();h()}function m(a,b){if(a)return b=b||{},$.ajax({url:a,data:b,method:"POST"})}function w(){ria_chat.state.article_id&&("ontouchstart"in window||ria_chat.state.chat.find("form textarea").focus(),$.ajax({url:ria_chat.state.getUnreadUrl,dataType:"json",data:{article_id:ria_chat.state.article_id,limit:ria_chat.state.goto_message?1E3:20}}).done(function(a){var b=a.chat_messages,c=a.chat_unread_messages,d=a.emoji_chat;if(b||c){b&&(_.assign(ria_chat.state,{user_id:a.user_id,
last_date:b.last_date,last_id:b.last_id}),n({banned_profiles:a.banned_profiles,data:b.messages}));if(a.report_message_ids)for(var e=0;e<a.report_message_ids.length;e++)$("#message_"+a.report_message_ids[e]).addClass("m-removed").find(".chat__lenta-item-message").html("\u0416\u0430\u043b\u043e\u0431\u0430 \u043d\u0430 \u043a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439 \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0430 \u0430\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440\u0430\u043c \u0441\u0430\u0439\u0442\u0430");
c&&c.messages.length&&(_.assign(ria_chat.state,{last_unread:c.messages[c.messages.length-1]}),k({count:c.total}),n({banned_profiles:a.banned_profiles,data:c.messages}));if(d&&d.length)for(e in d)a=d[e],q({emotions:a.emotions,sorted_emotions:a.sorted_emotions,message_id:a.object_id});setTimeout(function(){var a=ria_chat.state.chat_lenta.data("theinScroll");100===a.percentSizeScroller&&($("#chatScrollDownBtn").fadeOut(),0<ria_chat.state.unread&&g());0===a.percentSizeScroller&&$("#chatScrollTopBtn").fadeOut();
if(100===a.percentSizeScroller||100>a.sizeScrollLine-a.pxSizeScroller)window.dataLayer=window.dataLayer||[],dataLayer.push({event:"chat",gaEventAction:"chat_scroll",gaEventLabel:"comments_100%"})},99);setTimeout(function(){if(ria_chat.state.goto_message){var a=$("#message_"+ria_chat.state.goto_message);a.length?p(a.position().top-ria_chat.state.chat_lenta.data("theinScroll").$box.height()/2):l();ria_chat.state.goto_message=null}else t()},100);setTimeout(function(){ria_chat.state.chat_lenta.trigger("add-scrolling-trigger.the-in-scroll",
[{name:"refreshed_trigger",position:100,sign:"<",move:!0,everytime:!0}]);ria_chat.state.chat_lenta.on("refreshed_trigger.the-in-scroll",function(a,b){ria_chat.state.loading||f()})},101);setTimeout(function(){ria_chat.state.chat_lenta.trigger("add-scrolling-trigger.the-in-scroll",[{name:"hide_arrow_trigger",position:"99.9%",move:!0,everytime:!0}]);ria_chat.state.chat_lenta.trigger("add-scrolling-trigger.the-in-scroll",[{name:"show_arrow_trigger",position:"99.9%",sign:"<",move:!0,everytime:!0}]);ria_chat.state.chat_lenta.trigger("add-scrolling-trigger.the-in-scroll",
[{name:"hide_arrow_top_trigger",position:"50px",sign:"<",move:!0,everytime:!0}]);ria_chat.state.chat_lenta.trigger("add-scrolling-trigger.the-in-scroll",[{name:"show_arrow_top_trigger",position:"50px",sign:">",move:!0,everytime:!0}]);ria_chat.state.chat_lenta.on("hide_arrow_trigger.the-in-scroll",function(a,b){$("#chatScrollDownBtn").fadeOut();0<ria_chat.state.unread&&g()});ria_chat.state.chat_lenta.on("show_arrow_trigger.the-in-scroll",function(a,b){$("#chatScrollDownBtn").fadeIn()});ria_chat.state.chat_lenta.on("show_arrow_top_trigger.the-in-scroll",
function(a,b){$("#chatScrollTopBtn").fadeIn()});ria_chat.state.chat_lenta.on("hide_arrow_top_trigger.the-in-scroll",function(a,b){$("#chatScrollTopBtn").fadeOut()})},102)}}))}function n(a){for(var b="",c=a.data,f=a.prepend||!1,e=0;e<c.length;e++){c[e].time=d(1E3*c[e].ts_gmt);c[e].auth="ok"===GLOBAL.auth.status;c[e].letters=[];c[e].bg_number=0;for(var g=c[e].nickname.split(" "),h=0;2>h;h++)g[h]&&(c[e].bg_number+=g[h].length,c[e].letters.push(g[h].charAt(0)));c[e].bg_number=20<c[e].bg_number?Math.ceil(c[e].bg_number/
10):c[e].bg_number;c[e].is_moderator=!!GLOBAL.auth.moderator;c[e].user_id===ria_chat.state.user_id&&(c[e].is_my=!0);c[e].parent_comment&&c[e].parent_comment.user_id===ria_chat.state.user_id&&(c[e].parent_comment.is_my=!0);c[e].avatar&&(c[e].avatar=c[e].avatar.replace("https://cdn22.img.ria.ru/images/","").replace("https://cdn1.img.ria.ru/userpic/",""),c[e].avatar=GLOBAL.userpic+c[e].avatar);a.banned_profiles&&a.banned_profiles.length&&(c[e].is_blocked=!!a.banned_profiles.filter(function(a){return a.id===
c[e].user_id}).length);b+=ria_chat.state.messageTemplate({data:c[e]})}ria_chat.state.chat_lenta.trigger("add-content.the-in-scroll",[b,f]);for(e=0;e<c.length;e++)x($("#message_"+c[e].id))}function y(a){var b=$("#message_"+a.message_id);b.length&&(b.next(".chat__lenta-item").length?b.addClass("m-removed").find(".chat__lenta-item-message").html("\u0421\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0443\u0434\u0430\u043b\u0435\u043d\u043e \u0430\u0432\u0442\u043e\u0440\u043e\u043c"):b.slideUp("slow",
function(){b.remove()}))}function q(a){var b=0,c;for(c in a.emotions)b+=parseInt(a.emotions[c]);b=ria_chat.state.messageEmojiTemplate({data:{icons:{s1:{icon:"like_circle",title:"\u041d\u0440\u0430\u0432\u0438\u0442\u0441\u044f"},s2:{icon:"haha",title:"\u0425\u0430-\u0425\u0430"},s3:{icon:"wow",title:"\u0423\u0434\u0438\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e"},s4:{icon:"sad",title:"\u0413\u0440\u0443\u0441\u0442\u043d\u043e"},s5:{icon:"angry",title:"\u0412\u043e\u0437\u043c\u0443\u0442\u0438\u0442\u0435\u043b\u044c\u043d\u043e"},
s6:{icon:"dislike_circle",title:"\u041d\u0435 \u043d\u0440\u0430\u0432\u0438\u0442\u0441\u044f"}},emotions:a.emotions,sorted_emotions:a.sorted_emotions,emotions_count:b}});c=$("#message_"+a.message_id);if(c.length){var d=c.find(".chat__lenta-item-likes");d.length?d.replaceWith(b):c.find(".chat__lenta-item-message").eq(0).append(b);c.data("emotions",a.emotions)}}function z(a){a.preventDefault();a=$(this);var b=a.serializeArray();b[0].value&&(b.push({name:"article_id",value:ria_chat.state.article_id}),
"1"===GLOBAL.user.showCaptcha?(window.chatRecaptchaCallback=$.proxy(function(){grecaptcha.execute(GLOBAL.locale.grecaptcha.site_key_chat).then(function(a){b.push({name:"g-recaptcha-response",value:a});m(ria_chat.state.addUrl,b)})},this),loadJS("https://www.google.com/recaptcha/api.js?render="+GLOBAL.locale.grecaptcha.site_key_chat+"&onload=chatRecaptchaCallback")):m(ria_chat.state.addUrl,b),a[0].reset(),"ontouchstart"in window||a.find("textarea").focus().trigger("keyup"),$(".chat__reply").remove())}
function A(a){13!=a.which||a.shiftKey||($(this).closest("form").submit(),a.preventDefault())}function B(a){a.preventDefault();a=$(this).data("id");var b=$("#message_"+a);m(ria_chat.state.reportUrl,{article_id:ria_chat.state.article_id,message_id:a});b.addClass("m-removed").find(".chat__lenta-item-message").html("\u0416\u0430\u043b\u043e\u0431\u0430 \u043d\u0430 \u043a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439 \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0430 \u0430\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440\u0430\u043c \u0441\u0430\u0439\u0442\u0430")}
function C(a){a.preventDefault();m(ria_chat.state.deleteUrl,{article_id:ria_chat.state.article_id,message_id:$(this).data("id")})}function D(a){a.preventDefault();m(ria_chat.state.deleteModeratorUrl,{article_id:ria_chat.state.article_id,message_id:$(this).data("id")})}function E(a){a=$(this);var b={article_id:GLOBAL.article.id,message_id:a.data("message_id")};m(ria_chat.state.deleteModeratorUrl,b);a.closest(".best-comments__item").remove()}function F(a){a.preventDefault();if("ok"===GLOBAL.auth.status.toLowerCase()){a=
$(this).data("id");var b=$("#message_"+a);a={id:a,user:b.find(".chat__lenta-item-name-text")[0].innerText,comment:b.find(".chat__lenta-item-message-text")[0].innerText};a=ria_chat.state.replyTemplate({data:a});ria_chat.state.chat.find(".chat__reply").remove();ria_chat.state.chat.find(".chat__input form").append(a);ria_chat.state.chat.find("form textarea").focus()}}function G(a){$(this).closest(".chat__reply").remove()}function H(a){a.stopPropagation();a.preventDefault();"ok"!==GLOBAL.auth.status||
ria_chat.state.emoji_loading||(a=$(this),a={article_id:ria_chat.state.article_id,message_id:a.data("id"),emotion:a.data("type")},ria_chat.state.emoji_loading=!0,m(ria_chat.state.emojiUrl,a).done(function(a){a=JSON.parse(a);"error"!==a.emoji.status&&(a=ria_chat.state.emojiPopperTemplate({data:{id:a.emoji.data.object_id,emotions:a.emoji.data.emotions}}),$(".chat__popper-emoji").html($(a).find(".emoji")))}).always(function(){ria_chat.state.emoji_loading=!1}))}function I(a){a.stopPropagation();a.preventDefault();
if("ok"===GLOBAL.auth.status&&!ria_chat.state.emoji_loading){var b=$(this);a={article_id:GLOBAL.article.id,message_id:b.data("id"),emotion:b.data("type")};ria_chat.state.emoji_loading=!0;m(ria_chat.state.emojiUrl,a).done(function(a){a=JSON.parse(a);"error"!==a.emoji.status&&(a=ria_chat.state.emojiPopperTemplate({data:{id:a.emoji.data.object_id,emotions:a.emoji.data.emotions}}),b.closest(".emoji").replaceWith($(a).find(".emoji")))}).always(function(){ria_chat.state.emoji_loading=!1})}}function J(a){a=
$(this).closest(".chat");var b=a.find(".chat__input-editor"),c=$(this),d=a.find(".chat__input-admin");setTimeout(function(){c.css("height",0);var a=Math.min(72,c[0].scrollHeight);b.css("height",a);c.css("height",a);ria_chat.state.chat_lenta.css("bottom",33+a+d.outerHeight())},0)}function K(a){a.preventDefault();modalLayer.open({customTitle:"\u041f\u0435\u0440\u0435\u0445\u043e\u0434 \u043f\u043e \u0432\u043d\u0435\u0448\u043d\u0435\u0439 \u0441\u0441\u044b\u043b\u043a\u0435",customContent:'<div class="modal__text">\u0412\u044b \u043f\u043e\u043a\u0438\u0434\u0430\u0435\u0442\u0435 \u0441\u0430\u0439\u0442 <b>ria.ru</b> \u0438 \u043f\u0435\u0440\u0435\u0445\u043e\u0434\u0438\u0442\u0435 \u043f\u043e \u0432\u043d\u0435\u0448\u043d\u0435\u0439 \u0441\u0441\u044b\u043b\u043a\u0435. \u0410\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f <b>ria.ru</b> \u043d\u0435 \u043d\u0435\u0441\u0435\u0442 \u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0435\u043d\u043d\u043e\u0441\u0442\u0438 \u0437\u0430 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0435 \u0441\u0430\u0439\u0442\u0430 $1 \u0438 \u043d\u0430\u0441\u0442\u043e\u044f\u0442\u0435\u043b\u044c\u043d\u043e \u0440\u0435\u043a\u043e\u043c\u0435\u043d\u0434\u0443\u0435\u0442 <b>\u043d\u0435 \u0443\u043a\u0430\u0437\u044b\u0432\u0430\u0442\u044c</b> \u043d\u0438\u043a\u0430\u043a\u0438\u0445 \u0441\u0432\u043e\u0438\u0445 \u0434\u0430\u043d\u043d\u044b\u0445, \u0438\u043c\u0435\u044e\u0449\u0438\u0445 \u043e\u0442\u043d\u043e\u0448\u0435\u043d\u0438\u0435 \u043a <b>ria.ru</b>, \u043d\u0430 \u0441\u0442\u043e\u0440\u043e\u043d\u043d\u0438\u0445 \u0441\u0430\u0439\u0442\u0430\u0445.</div><a class="modal__button-link" target="_blank" href="$1">\u0412\u0441\u0435 \u0440\u0430\u0432\u043d\u043e \u043f\u0435\u0440\u0435\u0439\u0442\u0438</a>'.replace(/\$1/g,
$(this).attr("href"))})}function x(a){var b=a.find(".chat__lenta-item-message-text").text().trim(),c=/\b(?:https?):\/\/ria.ru\/[a-z0-9-+&@#\/%=~_.|]*/gi,d=/(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gi;if(c.test(b))for(c.lastIndex=0;null!==(d=c.exec(b));){var e=d[0];$.ajax({url:e,dataType:"html"}).done(function(b){b.length&&(b=$(b),b={title:b.filter("title").text(),time:"",img:b.filter('meta[property="og:image"]').attr("content"),url:e},b=ria_chat.state.snippetTemplate({data:b}),
a.find(".chat__lenta-item-message-text").append(b))})}else d.test(b)&&(b=b.replace(d,'<a class="m-external" href="$1" target="_blank">$1</a>'),a.find(".chat__lenta-item-message-text").html(b))}function L(a){$(this).toggleClass("m-open")}function M(a){a.stopPropagation();a=$(this);var b;b=a.closest(".popper-wrapper");var c=a.data("for");$(".chat__popper-inner").remove();b=ria_chat.state[c]({data:{id:b.data("id"),user_id:b.data("user_id"),emotions:b.data("emotions")}});$("body").append(b);b=$(".chat__popper-inner");
b.length&&(new Popper(a,b,{placement:a.data("placement")||"left",modifiers:{preventOverflow:{enabled:!0,padding:0,boundariesElement:768<$(document).width()?a.closest(".the-in-scroll__content"):"window"}}}),b.fadeToggle(),$("body").one("click.chat__popper-inner",function(){$(".chat__popper-inner").remove()}))}function N(a){a=$(this).data("user_id");var b=$('.chat__lenta-item[data-user_id="'+a+'"]');$.ajax({url:"/services/chat/blacklist/add/",data:{blocked_user_id:a}}).done(function(){b.each(function(){$(this).addClass("m-blocked").find(".chat__lenta-item-message").eq(0).after('<div class="chat__lenta-item-message m-blocked">\u0412\u044b \u0437\u0430\u0431\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u0430\u043b\u0438 \u043a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0438 \u044d\u0442\u043e\u0433\u043e \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f <a class="chat__actions-unblock">\u0420\u0430\u0437\u0431\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u0430\u0442\u044c</a></div>')})})}
function O(a){a=$(this).closest(".chat__lenta-item").data("user_id");var b=$('.chat__lenta-item[data-user_id="'+a+'"]');$.ajax({url:"/services/chat/blacklist/remove/",data:{blocked_user_id:a}}).done(function(){b.each(function(){$(this).removeClass("m-blocked").find(".chat__lenta-item-message.m-blocked").remove()})})}var r={addUrl:"/services/chat/add/",eventUrl:"/services/chat/event/",likeUrl:"/services/chat/like/",emojiUrl:"/services/chat/add_emoji/",getUrl:"/services/chat/get/",deleteUrl:"/services/chat/delete/",
deleteModeratorUrl:"/services/chat/moderation/delete/",reportUrl:"/services/chat/report/",unreadUrl:"/services/chat/get_unread_counter/",getUnreadUrl:"/services/chat/get_unread_message/",setLastUrl:"/services/chat/set_last_message/",sockUrl:"http://docker-test1.rian.off:8008/chat",article_id:"",chat:null,sock:!1,loading:!1,unread:0};ria_chat={state:{},init:function(a){_.assign(a,{sock:ria_sock.get()});_.assign(r,a);_.assign(this.state,r);ria_sock.on("chat_message",function(a){n({data:[a]});a.user_id===
ria_chat.state.user_id?l():100===ria_chat.state.chat_lenta.data("theinScroll").percentSizeScroller?(_.assign(ria_chat.state,{last_unread:{id:a.id,created:{sec:a.date.sec,usec:a.date.usec}}}),g()):98>ria_chat.state.chat_lenta.data("theinScroll").scrollingPercentage?(_.assign(ria_chat.state,{last_unread:{id:a.id,created:{sec:a.date.sec,usec:a.date.usec}}}),k({before:$("#message_"+a.id),count:1}),ria_chat.state.unreadWhenChatOpen=!0):98<=ria_chat.state.chat_lenta.data("theinScroll").scrollingPercentage&&
(_.assign(ria_chat.state,{last_unread:{id:a.id,created:{sec:a.date.sec,usec:a.date.usec}}}),g(),l())});ria_sock.on("chat_message_delete",function(a){y(a)});ria_sock.on("chat_emoji_add",function(a){q(a)});ria_sock.on("onopen",function(){var a=ria_chat.state.article_id;a&&(ria_chat.left(),ria_chat.join(a))});ria_sock.on("user_notify",function(a){"site_user_ban"===a.subtype&&($(".chat__banned").show(),$(".chat__lenta").addClass("m-banned"),a.count?$("#chatBannedTime").text(a.count+" \u0447\u0430\u0441\u043e\u0432"):
$("#chatBannedTime").text("\u221e"));"site_user_unban"===a.subtype&&($(".chat__form").show(),$(".chat__banned").hide(),$(".chat__lenta").removeClass("m-banned"))});return this},join:function(a){_.assign(ria_chat.state,{article_id:a});ria_sock.send({type:"chat_user_join",message:{obj_id:a}});w()},left:function(){ria_chat.state.article_id&&(ria_chat.state.sock&&ria_sock.connected&&ria_sock.send({type:"chat_user_left",message:{obj_id:ria_chat.state.article_id}}),ria_chat.state.chat_lenta.off("refreshed_trigger.the-in-scroll"),
ria_chat.state.chat_lenta.off("unread_trigger.the-in-scroll"),ria_chat.state.chat_lenta.off("show_arrow_trigger.the-in-scroll"),ria_chat.state.chat_lenta.off("show_arrow_top_trigger.the-in-scroll"),ria_chat.state.chat_lenta.off("hide_arrow_trigger.the-in-scroll"),ria_chat.state.chat_lenta.off("hide_arrow_top_trigger.the-in-scroll"),ria_chat.state.chat_lenta.trigger("clear-content.the-in-scroll"),ria_chat.state.chat.find("form")[0].reset(),$("#chatScrollDownBtn").removeAttr("count").fadeIn(),$("#chatScrollTopBtn").fadeIn(),
$(".chat__alert-unread").remove(),_.assign(ria_chat.state,r))},disconnect:function(){this.state.sock&&this.state.sock.close()},auth:function(){var a=ria_chat.state.article_id;a&&(ria_chat.left(),ria_chat.join(a));GLOBAL.user.isBanned&&($(".chat__banned").show(),$(".chat__lenta").addClass("m-banned"),GLOBAL.user.banTimeEnd?$("#chatBannedTime").text(GLOBAL.user.banTimeEnd):$("#chatBannedTime").text("\u221e"));ria_chat.state.chat.find(".chat__auth").hide();ria_chat.state.chat.find(".chat__input").show()}};
$(function(){$("#messageTemplate").length||$.ajax({async:!1,url:"/services/templates/",dataType:"html"}).done(function(a){$("body").append(a)});ria_chat.init({chat:$("#chat"),chat_lenta:$("#chat").find(".chat__lenta"),messageTemplate:_.template($("#messageTemplate").html()),replyTemplate:_.template($("#replyTemplate").html()),snippetTemplate:_.template($("#snippetTemplate").html()),alertDownTemplate:_.template($("#alertDownTemplate").html()),alertUnreadTemplate:_.template($("#alertUnreadTemplate").html()),
userbarPopperTemplate:_.template($("#userbarPopperTemplate").html()),myuserbarPopperTemplate:_.template($("#myuserbarPopperTemplate").html()),emojiPopperTemplate:_.template($("#emojiPopperTemplate").html()),messageEmojiTemplate:_.template($("#messageEmojiTemplate").html())});var a=$("body");a.on("submit",".chat__form",z);a.on("keypress",".chat__form-textarea",A);a.on("click",".chat__actions-report",B);a.on("click",".chat__actions-delete",C);a.on("click",".chat__actions-delete-moderator",D);a.on("click",
".chat__popper-emoji .emoji-item",H);a.on("click",".chat__actions-reply",F);a.on("dblclick",".chat__lenta-item-message",function(){$(this).closest(".chat__lenta-item").find(".chat__actions-reply").trigger("click")});a.on("click",".chat__reply-remove",G);a.on("click",".chat__alert-down",u);a.on("click",".chat__alert-top",v);a.on("input change paste keyup mouseup",".chat__form-textarea",J);a.on("click",".chat a.m-external",K);a.on("click",".chat__lenta-quote",L);a.on("click",".best-comments__item-message-moderation .m-delete",
E);a.on("click",".best__popper-emoji .emoji-item",I);a.on("click",".popper-btn",M);a.on("click",".chat__actions-block",N);a.on("click",".chat__actions-unblock",O)})})();
