var $jscomp={scope:{},findInternal:function(a,e,c){a instanceof String&&(a=String(a));for(var f=a.length,d=0;d<f;d++){var b=a[d];if(e.call(c,b,d,a))return{i:d,v:b}}return{i:-1,v:void 0}}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,e,c){if(c.get||c.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[e]=c.value)};
$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(a,e,c,f){if(e){c=$jscomp.global;a=a.split(".");for(f=0;f<a.length-1;f++){var d=a[f];d in c||(c[d]={});c=c[d]}a=a[a.length-1];f=c[a];e=e(f);e!=f&&null!=e&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:e})}};
$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,c){return $jscomp.findInternal(this,a,c).v}},"es6-impl","es3");
(function(a,e,c,f){var d=function(b,c){var g={};this.el=a(b);this.btn=this.el.find("button");this.id=this.el.data("vote-id").toString();this.defOptions=g;this.userOptions=c;this.options=a.extend(!0,{},g,c);this.init()};d.prototype.init=function(){var b=this;(b.el.hasClass("m-vote-disabled")||b.checkVoted(b.id))&&a.ajax({url:"/services/vote/get_result/",dataType:"json",data:{vote_id:b.id}}).done(function(a){b.showResults(a,!0)}).error(function(){console.log("vote ajax error - cant get result /services/vote/get_result/")});
b.el.find(".js-vote-answer").on("click",function(){b.el.find(".js-vote-answer input:checked:not(:disabled)").length?b.btn.removeAttr("disabled"):b.btn.attr("disabled","disabled")});b.el.find(".js-vote-switch-button").on("click",function(){b.el.hasClass("m-vote-results")?b.el.removeClass("m-vote-results"):a.ajax({url:"/services/vote/get_result/",dataType:"json",data:{vote_id:b.id}}).done(function(a){b.showResults(a)}).error(function(){console.log("vote ajax error - switch error /services/vote/get_result/")})});
b.el.find("form").on("submit",function(c){c.preventDefault();b.btn.attr("disabled","disabled");b.checkVoted(b.id)?b.showResults({},!0):(e["grecaptchaVote"+b.id]=a.proxy(function(){var b=this;grecaptcha.execute(GLOBAL.locale.grecaptcha.site_key).then(function(c){GLOBAL.locale.grecaptcha.token=c;a("input[name=g-recaptcha-response]",b.el).val(c);b.onSubmitAjax()})},b),loadJS("https://www.google.com/recaptcha/api.js?render="+GLOBAL.locale.grecaptcha.site_key+"&onload=grecaptchaVote"+b.id))})};d.prototype.onSubmitAjax=
function(){var b=this,c=b.el.find("form"),d=c.serializeArray();a.ajax({url:c.attr("action"),dataType:"json",data:d,type:"POST",beforeSend:function(){b.btn.attr("disabled","disabled")}}).done(function(c){b.showResults(c,!0);if(1==c.success){var e=[];a.each(d,function(){"vote_answer_id[]"==this.name&&e.push(this.value)});b.updateVoted(b.id,e)}}).error(function(){console.log("vote ajax error - submit error /services/vote/add/");b.btn.removeAttr("disabled")})};d.prototype.showResults=function(b,c){var d=
JSON.parse(ria.lsGet("ria-votes_"+this.id))||[];this.el.find(".js-vote-answer").each(function(){if("undefined"!==typeof b.answers&&"undefined"!==typeof b.answers[a(this).data("id")]){var e=b.answers[a(this).data("id")].percent;a(this).find(".js-vote-line").width(e+"%");a(this).find(".js-vote-percent span").text(e)}c&&(a(this).find("input").attr("disabled","disabled"),-1!=d.indexOf(a(this).data("id").toString())&&a(this).find("input").attr("checked","checked"))});0<b.total||""!=this.el.find(".js-vote-count-val").text()?
(this.el.find(".js-vote-count-val").text(b.total),this.el.find(".js-vote-count").removeClass("m-hidden")):this.el.find(".js-vote-count").addClass("m-hidden");this.el.addClass("m-vote-results")};d.prototype.checkVoted=function(a){return-1<(JSON.parse(ria.lsGet("ria.ru__ria-votes"))||[]).indexOf(a)};d.prototype.updateVoted=function(a,c){var b=JSON.parse(ria.lsGet("ria.ru__ria-votes"))||[],d=b.indexOf(a);-1<d&&d<b.length&&b.splice(d,1);b.push(a);100<b.length&&(d=b.shift(),ria.lsRemove("ria-votes_"+d));
ria.lsSet("ria.ru__ria-votes",JSON.stringify(b));ria.lsSet("ria-votes_"+a,JSON.stringify(c))};a.fn.riaVote=function(b){return this.each(function(){a.data(this,"riaVote")||a.data(this,"riaVote",new d(this,b))})}})(jQuery,window,document);
